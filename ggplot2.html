<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>统计笔记</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="YGC的统计学笔记">
  <meta name="generator" content="bookdown 0.0.63 and GitBook 2.6.7">

  <meta property="og:title" content="统计笔记" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="YGC的统计学笔记" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="统计笔记" />
  
  <meta name="twitter:description" content="YGC的统计学笔记" />
  

<meta name="author" content="余光创">

<meta name="date" content="2016-04-11">

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="r.html">
<link rel="next" href="section-4.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> 前言</a></li>
<li class="chapter" data-level="2" data-path="r.html"><a href="r.html"><i class="fa fa-check"></i><b>2</b> R语言简介</a><ul>
<li class="chapter" data-level="2.1" data-path="r.html"><a href="r.html#-flow-control"><i class="fa fa-check"></i><b>2.1</b> 控制流 （Flow Control)</a></li>
<li class="chapter" data-level="2.2" data-path="r.html"><a href="r.html#-looping"><i class="fa fa-check"></i><b>2.2</b> 循环 (Looping)</a></li>
<li class="chapter" data-level="2.3" data-path="r.html"><a href="r.html#covariancecorrelation"><i class="fa fa-check"></i><b>2.3</b> 协方差（covariance）和相关性（correlation）</a></li>
<li class="chapter" data-level="2.4" data-path="r.html"><a href="r.html#section-2.4"><i class="fa fa-check"></i><b>2.4</b> 对称性度量</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>3</b> 使用ggplot2画图</a><ul>
<li class="chapter" data-level="3.1" data-path="ggplot2.html"><a href="ggplot2.html#why-use-ggplot2"><i class="fa fa-check"></i><b>3.1</b> Why use ggplot2</a></li>
<li class="chapter" data-level="3.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2"><i class="fa fa-check"></i><b>3.2</b> ggplot2基本要素</a></li>
<li class="chapter" data-level="3.3" data-path="ggplot2.html"><a href="ggplot2.html#datamapping"><i class="fa fa-check"></i><b>3.3</b> 数据（Data）和映射（Mapping)</a></li>
<li class="chapter" data-level="3.4" data-path="ggplot2.html"><a href="ggplot2.html#geometric"><i class="fa fa-check"></i><b>3.4</b> 几何对象（Geometric）</a><ul>
<li class="chapter" data-level="3.4.1" data-path="ggplot2.html"><a href="ggplot2.html#section-3.4.1"><i class="fa fa-check"></i><b>3.4.1</b> 直方图</a></li>
<li class="chapter" data-level="3.4.2" data-path="ggplot2.html"><a href="ggplot2.html#section-3.4.2"><i class="fa fa-check"></i><b>3.4.2</b> 密度函数图</a></li>
<li class="chapter" data-level="3.4.3" data-path="ggplot2.html"><a href="ggplot2.html#section-3.4.3"><i class="fa fa-check"></i><b>3.4.3</b> 箱式图</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="ggplot2.html"><a href="ggplot2.html#scale"><i class="fa fa-check"></i><b>3.5</b> 标尺（Scale）</a></li>
<li class="chapter" data-level="3.6" data-path="ggplot2.html"><a href="ggplot2.html#statistics"><i class="fa fa-check"></i><b>3.6</b> 统计变换（Statistics）</a></li>
<li class="chapter" data-level="3.7" data-path="ggplot2.html"><a href="ggplot2.html#coordinante"><i class="fa fa-check"></i><b>3.7</b> 坐标系统（Coordinante）</a></li>
<li class="chapter" data-level="3.8" data-path="ggplot2.html"><a href="ggplot2.html#layer"><i class="fa fa-check"></i><b>3.8</b> 图层（Layer）</a></li>
<li class="chapter" data-level="3.9" data-path="ggplot2.html"><a href="ggplot2.html#facet"><i class="fa fa-check"></i><b>3.9</b> 分面（Facet）</a></li>
<li class="chapter" data-level="3.10" data-path="ggplot2.html"><a href="ggplot2.html#theme"><i class="fa fa-check"></i><b>3.10</b> 主题（Theme）</a></li>
<li class="chapter" data-level="3.11" data-path="ggplot2.html"><a href="ggplot2.html#section-3.11"><i class="fa fa-check"></i><b>3.11</b> 二维密度图</a></li>
<li class="chapter" data-level="3.12" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2"><i class="fa fa-check"></i><b>3.12</b> ggplot2实战</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="section-4.html"><a href="section-4.html"><i class="fa fa-check"></i><b>4</b> 统计检验基础</a><ul>
<li class="chapter" data-level="4.1" data-path="section-4.html"><a href="section-4.html#section-4.1"><i class="fa fa-check"></i><b>4.1</b> 概率分布</a><ul>
<li class="chapter" data-level="4.1.1" data-path="section-4.html"><a href="section-4.html#section-4.1.1"><i class="fa fa-check"></i><b>4.1.1</b> 均值与方差</a></li>
<li class="chapter" data-level="4.1.2" data-path="section-4.html"><a href="section-4.html#section-4.1.2"><i class="fa fa-check"></i><b>4.1.2</b> 二项式分布</a></li>
<li class="chapter" data-level="4.1.3" data-path="section-4.html"><a href="section-4.html#poisson"><i class="fa fa-check"></i><b>4.1.3</b> Poisson分布</a></li>
<li class="chapter" data-level="4.1.4" data-path="section-4.html"><a href="section-4.html#section-4.1.4"><i class="fa fa-check"></i><b>4.1.4</b> 正态分布</a></li>
<li class="chapter" data-level="4.1.5" data-path="section-4.html"><a href="section-4.html#t"><i class="fa fa-check"></i><b>4.1.5</b> t分布</a></li>
<li class="chapter" data-level="4.1.6" data-path="section-4.html"><a href="section-4.html#section-4.1.6"><i class="fa fa-check"></i><b>4.1.6</b> 卡方分布</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="section-4.html"><a href="section-4.html#p"><i class="fa fa-check"></i><b>4.2</b> 统计检验与p值</a><ul>
<li class="chapter" data-level="4.2.1" data-path="section-4.html"><a href="section-4.html#section-4.2.1"><i class="fa fa-check"></i><b>4.2.1</b> 零假设</a></li>
<li class="chapter" data-level="4.2.2" data-path="section-4.html"><a href="section-4.html#p"><i class="fa fa-check"></i><b>4.2.2</b> P值</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="section-4.html"><a href="section-4.html#confidence-intervals"><i class="fa fa-check"></i><b>4.3</b> Confidence Intervals</a><ul>
<li class="chapter" data-level="4.3.1" data-path="section-4.html"><a href="section-4.html#section-4.3.1"><i class="fa fa-check"></i><b>4.3.1</b> 均值置信区间</a></li>
<li class="chapter" data-level="4.3.2" data-path="section-4.html"><a href="section-4.html#section-4.3.2"><i class="fa fa-check"></i><b>4.3.2</b> 比例的置信区间</a></li>
<li class="chapter" data-level="4.3.3" data-path="section-4.html"><a href="section-4.html#section-4.3.3"><i class="fa fa-check"></i><b>4.3.3</b> 方差和标准差的置信区间</a></li>
<li class="chapter" data-level="4.3.4" data-path="section-4.html"><a href="section-4.html#section-4.3.4"><i class="fa fa-check"></i><b>4.3.4</b> 均值差的置信区间</a></li>
<li class="chapter" data-level="4.3.5" data-path="section-4.html"><a href="section-4.html#section-4.3.5"><i class="fa fa-check"></i><b>4.3.5</b> 相关性置信区间</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="section-4.html"><a href="section-4.html#t"><i class="fa fa-check"></i><b>5</b> T检验</a><ul>
<li class="chapter" data-level="5.1" data-path="section-4.html"><a href="section-4.html#t"><i class="fa fa-check"></i><b>5.1</b> 单样本T检验</a><ul>
<li class="chapter" data-level="5.1.1" data-path="t.html"><a href="t.html"><i class="fa fa-check"></i><b>5.1.1</b> 前提条件</a></li>
<li class="chapter" data-level="5.1.2" data-path="t.html"><a href="t.html#section-5.1.2"><i class="fa fa-check"></i><b>5.1.2</b> 数据标准化</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="t.html"><a href="t.html#z"><i class="fa fa-check"></i><b>5.2</b> Z检验</a><ul>
<li class="chapter" data-level="5.2.1" data-path="t.html"><a href="t.html#t-1"><i class="fa fa-check"></i><b>5.2.1</b> t检验</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="section-4.html"><a href="section-4.html#t"><i class="fa fa-check"></i><b>5.3</b> 两样本T检验</a><ul>
<li class="chapter" data-level="5.3.1" data-path="section-4.html"><a href="section-4.html#t"><i class="fa fa-check"></i><b>5.3.1</b> 成对T检验</a></li>
<li class="chapter" data-level="5.3.2" data-path="section-4.html"><a href="section-4.html#t"><i class="fa fa-check"></i><b>5.3.2</b> 方差相同的两样本T检验</a></li>
<li class="chapter" data-level="5.3.3" data-path="section-4.html"><a href="section-4.html#t"><i class="fa fa-check"></i><b>5.3.3</b> 方差不同的两样本T检验</a></li>
<li class="chapter" data-level="5.3.4" data-path="t.html"><a href="t.html#rt"><i class="fa fa-check"></i><b>5.3.4</b> 使用R进行T检验</a></li>
<li class="chapter" data-level="5.3.5" data-path="t.html"><a href="t.html#section-5.3.5"><i class="fa fa-check"></i><b>5.3.5</b> 结论</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="section-6.html"><a href="section-6.html"><i class="fa fa-check"></i><b>6</b> 方差分析</a><ul>
<li class="chapter" data-level="6.1" data-path="section-6.html"><a href="section-6.html#one-way-anova"><i class="fa fa-check"></i><b>6.1</b> One-Way ANOVA</a><ul>
<li class="chapter" data-level="6.1.1" data-path="section-6.html"><a href="section-6.html#section-6.1.1"><i class="fa fa-check"></i><b>6.1.1</b> 单向方差分析</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="section-6.html"><a href="section-6.html#tukeyhsd---tukey-honestly-significant-difference"><i class="fa fa-check"></i><b>6.2</b> TukeyHSD - Tukey honestly significant difference</a><ul>
<li class="chapter" data-level="6.2.1" data-path="section-4.html"><a href="section-4.html#t"><i class="fa fa-check"></i><b>6.2.1</b> 两两T检验</a></li>
<li class="chapter" data-level="6.2.2" data-path="section-6.html"><a href="section-6.html#section-6.2.2"><i class="fa fa-check"></i><b>6.2.2</b> 如何理解方差分析</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="section-6.html"><a href="section-6.html#two-way-anova"><i class="fa fa-check"></i><b>6.3</b> Two-Way ANOVA</a><ul>
<li class="chapter" data-level="6.3.1" data-path="section-6.html"><a href="section-6.html#-1"><i class="fa fa-check"></i><b>6.3.1</b> 前提条件</a></li>
<li class="chapter" data-level="6.3.2" data-path="section-6.html"><a href="section-6.html#-1"><i class="fa fa-check"></i><b>6.3.2</b> 零假设</a></li>
<li class="chapter" data-level="6.3.3" data-path="section-6.html"><a href="section-6.html#section-6.3.3"><i class="fa fa-check"></i><b>6.3.3</b> 方差计算</a></li>
<li class="chapter" data-level="6.3.4" data-path="section-4.html"><a href="section-4.html#p"><i class="fa fa-check"></i><b>6.3.4</b> p值计算</a></li>
<li class="chapter" data-level="6.3.5" data-path="section-6.html"><a href="section-6.html#anova-using-r"><i class="fa fa-check"></i><b>6.3.5</b> ANOVA using R</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="section-6.html"><a href="section-6.html#advanced-anova"><i class="fa fa-check"></i><b>6.4</b> Advanced ANOVA</a><ul>
<li class="chapter" data-level="6.4.1" data-path="section-6.html"><a href="section-6.html#repeated-measures-anova"><i class="fa fa-check"></i><b>6.4.1</b> Repeated-Measures ANOVA</a></li>
<li class="chapter" data-level="6.4.2" data-path="section-6.html"><a href="section-6.html#mixed-factorial-anova"><i class="fa fa-check"></i><b>6.4.2</b> Mixed-Factorial ANOVA</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="correlation.html"><a href="correlation.html"><i class="fa fa-check"></i><b>7</b> Correlation</a><ul>
<li class="chapter" data-level="7.1" data-path="correlation.html"><a href="correlation.html#-covariance"><i class="fa fa-check"></i><b>7.1</b> 协方差 (Covariance)</a></li>
<li class="chapter" data-level="7.2" data-path="correlation.html"><a href="correlation.html#-correlation"><i class="fa fa-check"></i><b>7.2</b> 相关性 (Correlation)</a></li>
<li class="chapter" data-level="7.3" data-path="correlation.html"><a href="correlation.html#section-7.3"><i class="fa fa-check"></i><b>7.3</b> 相关性统计检验</a></li>
<li class="chapter" data-level="7.4" data-path="correlation.html"><a href="correlation.html#section-7.4"><i class="fa fa-check"></i><b>7.4</b> 置信区间</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="section-8.html"><a href="section-8.html"><i class="fa fa-check"></i><b>8</b> 线性回归</a><ul>
<li class="chapter" data-level="8.1" data-path="section-8.html"><a href="section-8.html#simple-linear-regression"><i class="fa fa-check"></i><b>8.1</b> Simple Linear Regression</a><ul>
<li class="chapter" data-level="8.1.1" data-path="section-8.html"><a href="section-8.html#section-8.1.1"><i class="fa fa-check"></i><b>8.1.1</b> 评估参数准确性</a></li>
<li class="chapter" data-level="8.1.2" data-path="section-8.html"><a href="section-8.html#section-8.1.2"><i class="fa fa-check"></i><b>8.1.2</b> 评估模型准确性</a></li>
<li class="chapter" data-level="8.1.3" data-path="section-6.html"><a href="section-6.html#-1"><i class="fa fa-check"></i><b>8.1.3</b> 方差分析</a></li>
<li class="chapter" data-level="8.1.4" data-path="section-8.html"><a href="section-8.html#section-8.1.4"><i class="fa fa-check"></i><b>8.1.4</b> 可视化辅助诊断模型</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="section-8.html"><a href="section-8.html#multiple-linear-regression"><i class="fa fa-check"></i><b>8.2</b> Multiple Linear Regression</a><ul>
<li class="chapter" data-level="8.2.1" data-path="section-8.html"><a href="section-8.html#section-8.2.1"><i class="fa fa-check"></i><b>8.2.1</b> 相关问题</a></li>
<li class="chapter" data-level="8.2.2" data-path="section-8.html"><a href="section-8.html#section-8.2.2"><i class="fa fa-check"></i><b>8.2.2</b> 数值运算</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="general-linear-model.html"><a href="general-linear-model.html"><i class="fa fa-check"></i><b>9</b> General Linear Model</a><ul>
<li class="chapter" data-level="9.1" data-path="section-4.html"><a href="section-4.html#t"><i class="fa fa-check"></i><b>9.1</b> T检验是回归的特例</a></li>
<li class="chapter" data-level="9.2" data-path="section-4.html"><a href="section-4.html#t"><i class="fa fa-check"></i><b>9.2</b> T检验是方差分析的特例</a></li>
<li class="chapter" data-level="9.3" data-path="general-linear-model.html"><a href="general-linear-model.html#anova"><i class="fa fa-check"></i><b>9.3</b> ANOVA是多重回归的特例</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>10</b> Logistic Regression</a></li>
<li class="chapter" data-level="11" data-path="section-11.html"><a href="section-11.html"><i class="fa fa-check"></i><b>11</b> 生物实验统计分析</a><ul>
<li class="chapter" data-level="11.1" data-path="section-11.html"><a href="section-11.html#rt-pcr"><i class="fa fa-check"></i><b>11.1</b> RT-PCR</a><ul>
<li class="chapter" data-level="11.1.1" data-path="section-11.html"><a href="section-11.html#data"><i class="fa fa-check"></i><b>11.1.1</b> Data</a></li>
<li class="chapter" data-level="11.1.2" data-path="section-11.html"><a href="section-11.html#data-clean"><i class="fa fa-check"></i><b>11.1.2</b> Data clean</a></li>
<li class="chapter" data-level="11.1.3" data-path="section-11.html"><a href="section-11.html#calculate-statistical-metric"><i class="fa fa-check"></i><b>11.1.3</b> Calculate statistical metric</a></li>
<li class="chapter" data-level="11.1.4" data-path="section-11.html"><a href="section-11.html#statistical-analysis"><i class="fa fa-check"></i><b>11.1.4</b> Statistical Analysis</a></li>
<li class="chapter" data-level="11.1.5" data-path="section-11.html"><a href="section-11.html#plot"><i class="fa fa-check"></i><b>11.1.5</b> Plot</a></li>
<li class="chapter" data-level="11.1.6" data-path="section-11.html"><a href="section-11.html#summary"><i class="fa fa-check"></i><b>11.1.6</b> Summary</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">统计笔记</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ggplot2" class="section level1">
<h1><span class="header-section-number">3</span> 使用ggplot2画图</h1>
<div id="why-use-ggplot2" class="section level2">
<h2><span class="header-section-number">3.1</span> Why use ggplot2</h2>
<p>ggplot2是我见过最human friendly的画图软件，这得益于Leland Wilkinson在他的著作<a href="http://book.douban.com/subject/10123863/">《The Grammar of Graphics》</a>中提出了一套图形语法，把图形元素抽象成可以自由组合的成分，Hadley Wickham把这套想法在R中实现。</p>
<p>为什么要学习ggplot2，可以参考<a href="http://book.douban.com/subject/24527091/">ggplot2: 数据分析与图形艺术</a>的<a href="https://github.com/cosname/ggplot2-translation/blob/master/preface.md">序言</a>（btw: 在序言的最后，我被致谢了）。</p>
<p>Hadley Wickham也给出一堆<a href="https://github.com/hadley/ggplot2/wiki/Why-use-ggplot2">理由</a>让我们说服自己，我想再补充一点，Hadley Wickham是<a href="http://www.analyticstory.com/hadley-wickham/">学医出身</a>的，做为学生物出身的人有什么理由不支持呢:)</p>
</div>
<div id="ggplot2" class="section level2">
<h2><span class="header-section-number">3.2</span> ggplot2基本要素</h2>
<ul>
<li>数据（Data）和映射（Mapping）</li>
<li>几何对象（Geometric）</li>
<li>标尺（Scale）</li>
<li>统计变换（Statistics）</li>
<li>坐标系统（Coordinante）</li>
<li>图层（Layer）</li>
<li>分面（Facet）</li>
<li>主题（Theme）</li>
</ul>
<p>这里将从这些基本要素对ggplot2进行介绍。</p>
</div>
<div id="datamapping" class="section level2">
<h2><span class="header-section-number">3.3</span> 数据（Data）和映射（Mapping)</h2>
<p>下面以一份钻石的数据为例，这份数据非常大，随机取一个子集来画图。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(ggplot2)</code></pre></div>
<pre><code>## Loading required package: ggplot2</code></pre>
<pre><code>## 
## Attaching package: &#39;ggplot2&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:psych&#39;:
## 
##     %+%, alpha</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(diamonds)
<span class="kw">set.seed</span>(<span class="dv">42</span>)
small&lt;-diamonds[<span class="kw">sample</span>(<span class="kw">nrow</span>(diamonds),<span class="dv">1000</span>),] 
<span class="kw">head</span>(small)</code></pre></div>
<pre><code>##       carat       cut color clarity depth table price    x    y    z
## 49345  0.71 Very Good     H     SI1  62.5    60  2096 5.68 5.75 3.57
## 50545  0.79   Premium     H     SI1  61.8    59  2275 5.97 5.91 3.67
## 15434  1.03     Ideal     F     SI1  62.4    57  6178 6.48 6.44 4.03
## 44792  0.50     Ideal     E     VS2  62.2    54  1624 5.08 5.11 3.17
## 34614  0.27     Ideal     E     VS1  61.6    56   470 4.14 4.17 2.56
## 27998  0.30   Premium     E     VS2  61.7    58   658 4.32 4.34 2.67</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(small)</code></pre></div>
<pre><code>##      carat               cut      color      clarity        depth      
##  Min.   :0.2200   Fair     : 28   D:121   SI1    :258   Min.   :55.20  
##  1st Qu.:0.4000   Good     : 88   E:186   VS2    :231   1st Qu.:61.00  
##  Median :0.7100   Very Good:227   F:164   SI2    :175   Median :61.80  
##  Mean   :0.8187   Premium  :257   G:216   VS1    :141   Mean   :61.71  
##  3rd Qu.:1.0700   Ideal    :400   H:154   VVS2   : 91   3rd Qu.:62.50  
##  Max.   :2.6600                   I:106   VVS1   : 67   Max.   :72.20  
##                                   J: 53   (Other): 37                  
##      table           price               x               y        
##  Min.   :50.10   Min.   :  342.0   Min.   :3.850   Min.   :3.840  
##  1st Qu.:56.00   1st Qu.:  989.5   1st Qu.:4.740   1st Qu.:4.758  
##  Median :57.00   Median : 2595.0   Median :5.750   Median :5.775  
##  Mean   :57.43   Mean   : 4110.5   Mean   :5.787   Mean   :5.791  
##  3rd Qu.:59.00   3rd Qu.: 5495.2   3rd Qu.:6.600   3rd Qu.:6.610  
##  Max.   :65.00   Max.   :18795.0   Max.   :8.830   Max.   :8.870  
##                                                                   
##        z        
##  Min.   :2.330  
##  1st Qu.:2.920  
##  Median :3.550  
##  Mean   :3.572  
##  3rd Qu.:4.070  
##  Max.   :5.580  
## </code></pre>
<p>画图实际上是把数据中的变量映射到图形属性上。以克拉(carat)数为X轴变量，价格(price)为Y轴变量。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>small, <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>carat, <span class="dt">y=</span>price))</code></pre></div>
<p>上面这行代码把数据映射XY坐标轴上，需要告诉ggplot2，这些数据要映射成什么样的几何对象，下面以散点为例：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p+<span class="kw">geom_point</span>()</code></pre></div>
<p><img src="_main_files/figure-html/ggplot2_fig1-1.png" /><!-- --> 几何对象将在下面的小节介绍，这一节，关注的是数据和图形属性之间的映射。</p>
<p>如果想将切工（cut）映射到形状属性。只需要：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>small, <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>carat, <span class="dt">y=</span>price, <span class="dt">shape=</span>cut))
p+<span class="kw">geom_point</span>()</code></pre></div>
<p><img src="_main_files/figure-html/ggplot2_fig2-1.png" /><!-- --></p>
<p>再比如我想将钻石的颜色（color）映射颜色属性：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>small, <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>carat, <span class="dt">y=</span>price, <span class="dt">shape=</span>cut, <span class="dt">colour=</span>color))
p+<span class="kw">geom_point</span>()</code></pre></div>
<p><img src="_main_files/figure-html/ggplot2_fig3-1.png" /><!-- --></p>
</div>
<div id="geometric" class="section level2">
<h2><span class="header-section-number">3.4</span> 几何对象（Geometric）</h2>
<p>在上面的例子中，各种属性映射由ggplot函数执行，只需要加一个图层，使用geom_point()告诉ggplot要画散点，于是所有的属性都映射到散点上。</p>
<p>geom_point()完成的就是几何对象的映射，ggplot2提供了各种几何对象映射，如geom_histogram用于直方图，geom_bar用于画柱状图，geom_boxplot用于画箱式图等等。</p>
<p>不同的几何对象，要求的属性会有些不同，这些属性也可以在几何对象映射时提供，比如上一图，也可以用以下语法来画：</p>
<pre><code>p &lt;- ggplot(small)
p+geom_point(aes(x=carat, y=price, shape=cut, colour=color))</code></pre>
<p>ggplot2支持图层，我通常把不同的图层中共用的映射提供给ggplot函数，而某一几何对象才需要的映射参数提供给geom_xxx函数。</p>
<p>这一小节我们来看一下各种常用的几何对象。</p>
<div id="section-3.4.1" class="section level3">
<h3><span class="header-section-number">3.4.1</span> 直方图</h3>
<p>直方图最容易，提供一个x变量，画出数据的分布。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(small)+<span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x=</span>price))</code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="_main_files/figure-html/ggplot2_fig4-1.png" /><!-- --> 同样可以根据另外的变量给它填充颜色，比如按不同的切工：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(small)+<span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x=</span>price, <span class="dt">fill=</span>cut))</code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="_main_files/figure-html/ggplot2_fig5-1.png" /><!-- --> 也可以将其分开，side-by-side地画直方图。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(small)+<span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x=</span>price, <span class="dt">fill=</span>cut), <span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>)</code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="_main_files/figure-html/ggplot2_fig6-1.png" /><!-- --></p>
<p>还可以使用position=“fill”，按照相对比例来画。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(small)+<span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x=</span>price, <span class="dt">fill=</span>cut), <span class="dt">position=</span><span class="st">&quot;fill&quot;</span>)</code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="_main_files/figure-html/ggplot2_fig7-1.png" /><!-- --> ### 柱状图 柱状图非常适合于画分类变量。在这里以透明度（clarity）变量为例。按照不同透明度的钻石的数目画柱状图。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(small)+<span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span>clarity))</code></pre></div>
<p><img src="_main_files/figure-html/ggplot2_fig8-1.png" /><!-- --> 柱状图两个要素，一个是分类变量，一个是数目，也就是柱子的高度。数目在这里不用提供，因为ggplot2会通过x变量计算各个分类的数目。</p>
<p>当然你想提供也是可以的，通过stat参数，可以让geom_bar按指定高度画图，比如以下代码：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>()+<span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">c</span>(LETTERS[<span class="dv">1</span>:<span class="dv">3</span>]),<span class="dt">y=</span><span class="dv">1</span>:<span class="dv">3</span>), <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>)</code></pre></div>
<p><img src="_main_files/figure-html/ggplot2_fig24-1.png" /><!-- --></p>
<p>柱状图和直方图是很像的，直方图把连续型的数据按照一个个等长的分区（bin）来切分，然后计数，画柱状图。而柱状图是分类数据，按类别计数。我们可以用前面直方图的参数来画side-by-side的柱状图，填充颜色或者按比例画图，它们是高度一致的。</p>
<p>柱状图是用来表示计数数据的，但在生物界却被经常拿来表示均值，加上误差来表示数据分布，这可以通常图层来实现，我将在图层一节中给出实例。</p>
</div>
<div id="section-3.4.2" class="section level3">
<h3><span class="header-section-number">3.4.2</span> 密度函数图</h3>
<p>说到直方图，就不得不说密度函数图，数据和映射和直方图是一样的，唯一不同的是几何对象，geom_histogram告诉ggplot要画直方图，而geom_density则说我们要画密度函数图，在我们熟悉前面语法的情况下，很容易画出：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(small)+<span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">x=</span>price, <span class="dt">colour=</span>cut))</code></pre></div>
<p><img src="_main_files/figure-html/ggplot2_fig9-1.png" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(small)+<span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">x=</span>price,<span class="dt">fill=</span>clarity))</code></pre></div>
<p><img src="_main_files/figure-html/ggplot2_fig10-1.png" /><!-- --></p>
<p>colour参数指定的是曲线的颜色，而fill是往曲线下面填充颜色。</p>
</div>
<div id="section-3.4.3" class="section level3">
<h3><span class="header-section-number">3.4.3</span> 箱式图</h3>
<p>数据量比较大的时候，用直方图和密度函数图是表示数据分布的好方法，而在数据量较少的时候，比如很多的生物实验，很多时候大家都是使用柱状图+errorbar的形式来表示，不过这种方法的信息量非常低，被<a href="http://ygc.name/2014/03/04/boxplot/">Nature Methods吐槽</a>，这种情况推荐使用boxplot。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(small)+<span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>cut, <span class="dt">y=</span>price,<span class="dt">fill=</span>color))</code></pre></div>
<p><img src="_main_files/figure-html/ggplot2_fig11-1.png" /><!-- --> geom_boxplot将数据映射到箱式图上，上面的代码，我们应该很熟悉了，按切工(cut)分类，对价格(price)变量画箱式图，再分开按照color变量填充颜色。</p>
<p>ggplot2提供了很多的geom_xxx函数，可以满足我们对各种图形绘制的需求。</p>
<pre><code>geom_abline     geom_area   
geom_bar        geom_bin2d
geom_blank      geom_boxplot    
geom_contour    geom_crossbar
geom_density    geom_density2d  
geom_dotplot    geom_errorbar
geom_errorbarh  geom_freqpoly   
geom_hex        geom_histogram
geom_hline      geom_jitter     
geom_line       geom_linerange
geom_map        geom_path   
geom_point      geom_pointrange
geom_polygon    geom_quantile   
geom_raster     geom_rect
geom_ribbon     geom_rug    
geom_segment    geom_smooth
geom_step       geom_text   
geom_tile       geom_violin
geom_vline</code></pre>
</div>
</div>
<div id="scale" class="section level2">
<h2><span class="header-section-number">3.5</span> 标尺（Scale）</h2>
<p>前面我们已经看到了，画图就是在做映射，不管是映射到不同的几何对象上，还是映射各种图形属性。这一小节介绍标尺，在对图形属性进行映射之后，使用标尺可以控制这些属性的显示方式，比如坐标刻度，可能通过标尺，将坐标进行对数变换；比如颜色属性，也可以通过标尺，进行改变。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(small)+<span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x=</span>carat, <span class="dt">y=</span>price, <span class="dt">shape=</span>cut, <span class="dt">colour=</span>color))+<span class="kw">scale_y_log10</span>()+<span class="kw">scale_colour_manual</span>(<span class="dt">values=</span><span class="kw">rainbow</span>(<span class="dv">7</span>))</code></pre></div>
<p><img src="_main_files/figure-html/ggplot2_fig12-1.png" /><!-- --> 以数据（Data）和映射（Mapping)一节中所画散点图为例，将Y轴坐标进行log10变换，再自己定义颜色为彩虹色。</p>
</div>
<div id="statistics" class="section level2">
<h2><span class="header-section-number">3.6</span> 统计变换（Statistics）</h2>
<p>统计变换对原始数据进行某种计算，然后在图上表示出来，例如对散点图上加一条回归线。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(small, <span class="kw">aes</span>(<span class="dt">x=</span>carat, <span class="dt">y=</span>price))+<span class="kw">geom_point</span>()+<span class="kw">scale_y_log10</span>()+<span class="kw">stat_smooth</span>()</code></pre></div>
<p><img src="_main_files/figure-html/ggplot2_fig13-1.png" /><!-- --> 这里就不按颜色、切工来分了，不然ggplot会按不同的分类变量分别做回归，图就很乱，如果我们需要这样做，我们可以使用分面，这个将在后面介绍。</p>
<p>这里，aes所提供的参数，就通过ggplot提供，而不是提供给geom_point，因为ggplot里的参数，相当于全局变量，geom_point()和stat_smooth()都知道x,y的映射，如果只提供给geom_point()，则相当于是局部变量，geom_point知道这种映射，而stat_smooth不知道，当然你再给stat_smooth也提供x,y的映射，不过共用的映射，还是提供给ggplot好。</p>
<p>ggplot2提供了多种统计变换方式：</p>
<pre><code>stat_abline       stat_contour      stat_identity     stat_summary
stat_bin          stat_density      stat_qq           stat_summary2d
stat_bin2d        stat_density2d    stat_quantile     stat_summary_hex
stat_bindot       stat_ecdf         stat_smooth       stat_unique
stat_binhex       stat_function     stat_spoke        stat_vline
stat_boxplot      stat_hline        stat_sum          stat_ydensity</code></pre>
<p>统计变换是非常重要的功能，我们可以自己写函数，基于原始数据做某种计算，并在图上表现出来，也可以通过它改变geom_xxx函数画图的默认统计参数。 比如我在<a href="http://www.sciencedirect.com/science/article/pii/S1874391912007567">Proteomic investigation of the interactome of FMNL1 in hematopoietic cells unveils a role in calcium-dependent membrane plasticity</a>的图一中，就把boxplot的中位线替换成了平均值来作图。</p>
</div>
<div id="coordinante" class="section level2">
<h2><span class="header-section-number">3.7</span> 坐标系统（Coordinante）</h2>
<p>坐标系统控制坐标轴，可以进行变换，例如XY轴翻转，笛卡尔坐标和极坐标转换，以满足我们的各种需求。</p>
<p>坐标轴翻转由coord_flip()实现</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(small)+<span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span>cut, <span class="dt">fill=</span>cut))+<span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="_main_files/figure-html/ggplot2_fig14-1.png" /><!-- --></p>
<p>而转换成极坐标可以由coord_polar()实现：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(small)+<span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">factor</span>(<span class="dv">1</span>), <span class="dt">fill=</span>cut))+<span class="kw">coord_polar</span>(<span class="dt">theta=</span><span class="st">&quot;y&quot;</span>)</code></pre></div>
<p><img src="_main_files/figure-html/ggplot2_fig15-1.png" /><!-- --> 这也是为什么之前介绍常用图形画法时没有提及饼图的原因，饼图实际上就是柱状图，只不过是使用极坐标而已，柱状图的高度，对应于饼图的弧度，饼图并不推荐，因为人类的眼睛比较弧度的能力比不上比较高度（柱状图）。</p>
<p>还可以画靶心图：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(small)+<span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">factor</span>(<span class="dv">1</span>), <span class="dt">fill=</span>cut))+<span class="kw">coord_polar</span>()</code></pre></div>
<p><img src="_main_files/figure-html/ggplot2_fig16-1.png" /><!-- --> 以及风玫瑰图(windrose)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(small)+<span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x=</span>clarity, <span class="dt">fill=</span>cut))+<span class="kw">coord_polar</span>()</code></pre></div>
<p><img src="_main_files/figure-html/ggplot2_fig17-1.png" /><!-- --></p>
</div>
<div id="layer" class="section level2">
<h2><span class="header-section-number">3.8</span> 图层（Layer）</h2>
<p>photoshop流行的原因在于PS 3.0时引入图层的概念，ggplot的牛B之处在于使用+号来叠加图层，这堪称是泛型编程的典范。 在前面散点图上，我们已经见识过，加上了一个回归线拟合的图层。</p>
<p>在<a href="http://www.ygc.name/stats/RT_PCR.html">RT-PCR统计分析</a>中，我使用geom_bar()画了一个柱状图，再使用geom_errorbar()画了标准误，两个图层一叠加，就成了我们常画的加了errorbar的柱状图。</p>
<p>有了图层的概念，使用ggplot画起图来，就更加得心应手。</p>
<p>做为图层的一个很好的例子是<a href="http://ygc.name/2011/08/14/bat-man/">蝙蝠侠logo</a>，batman logo由6个函数组成，在下面的例子中，我先画第一个函数，之后再加一个图层画第二个函数，不断重复这一过程，直到六个函数全部画好。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(grid)</code></pre></div>
<pre><code>## Loading required package: grid</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(ggplot2)
 
f1 &lt;-<span class="st"> </span>function(x) {
    y1 &lt;-<span class="st"> </span><span class="dv">3</span>*<span class="kw">sqrt</span>(<span class="dv">1</span>-(x/<span class="dv">7</span>)^<span class="dv">2</span>)
    y2 &lt;-<span class="st"> </span>-<span class="dv">3</span>*<span class="kw">sqrt</span>(<span class="dv">1</span>-(x/<span class="dv">7</span>)^<span class="dv">2</span>)
    y &lt;-<span class="st"> </span><span class="kw">c</span>(y1,y2)
    d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span>x,<span class="dt">y=</span>y)
    d &lt;-<span class="st"> </span>d[d$y &gt;<span class="st"> </span>-<span class="dv">3</span>*<span class="kw">sqrt</span>(<span class="dv">33</span>)/<span class="dv">7</span>,]
    <span class="kw">return</span>(d)
}
 
x1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">seq</span>(<span class="dv">3</span>, <span class="dv">7</span>, <span class="fl">0.001</span>), <span class="kw">seq</span>(-<span class="dv">7</span>, -<span class="dv">3</span>, <span class="fl">0.001</span>))
d1 &lt;-<span class="st"> </span><span class="kw">f1</span>(x1)
p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(d1,<span class="kw">aes</span>(x,y)) +<span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">color=</span><span class="st">&quot;red&quot;</span>) +<span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>) +<span class="st"> </span><span class="kw">theme_bw</span>()
 
x2 &lt;-<span class="st"> </span><span class="kw">seq</span>(-<span class="dv">4</span>,<span class="dv">4</span>, <span class="fl">0.001</span>)
y2 &lt;-<span class="st"> </span><span class="kw">abs</span>(x2/<span class="dv">2</span>)-(<span class="dv">3</span>*<span class="kw">sqrt</span>(<span class="dv">33</span>)-<span class="dv">7</span>)*x2^<span class="dv">2</span>/<span class="dv">112-3</span> +<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">1</span>-(<span class="kw">abs</span>(<span class="kw">abs</span>(x2)-<span class="dv">2</span>)-<span class="dv">1</span>)^<span class="dv">2</span>)
d2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x2=</span>x2, <span class="dt">y2=</span>y2)
p2 &lt;-<span class="st"> </span>p1 +<span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">data=</span>d2, <span class="kw">aes</span>(<span class="dt">x=</span>x2,<span class="dt">y=</span>y2), <span class="dt">color=</span><span class="st">&quot;yellow&quot;</span>)
 
x3 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">seq</span>(<span class="fl">0.75</span>,<span class="dv">1</span>,<span class="fl">0.001</span>), <span class="kw">seq</span>(-<span class="dv">1</span>,-<span class="fl">0.75</span>,<span class="fl">0.001</span>))
y3 &lt;-<span class="st"> </span><span class="dv">9-8</span>*<span class="kw">abs</span>(x3)
d3 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x3=</span>x3, <span class="dt">y3=</span>y3)
p3 &lt;-<span class="st"> </span>p2+<span class="kw">geom_point</span>(<span class="dt">data=</span>d3, <span class="kw">aes</span>(<span class="dt">x=</span>x3,<span class="dt">y=</span>y3), <span class="dt">color=</span><span class="st">&quot;green&quot;</span>)
 
x4 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">seq</span>(<span class="fl">0.5</span>,<span class="fl">0.75</span>,<span class="fl">0.001</span>), <span class="kw">seq</span>(-<span class="fl">0.75</span>,-<span class="fl">0.5</span>,<span class="fl">0.001</span>))
y4 &lt;-<span class="st"> </span><span class="dv">3</span>*<span class="kw">abs</span>(x4)+<span class="fl">0.75</span>
d4 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x4=</span>x4,<span class="dt">y4=</span>y4)
p4 &lt;-<span class="st"> </span>p3+<span class="kw">geom_point</span>(<span class="dt">data=</span>d4, <span class="kw">aes</span>(<span class="dt">x=</span>x4,<span class="dt">y=</span>y4), <span class="dt">color=</span><span class="st">&quot;steelblue&quot;</span>)
  
x5 &lt;-<span class="st"> </span><span class="kw">seq</span>(-<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.001</span>)
y5 &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="fl">2.25</span>,<span class="kw">length</span>(x5))
d5 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x5=</span>x5,<span class="dt">y5=</span>y5)
p5 &lt;-<span class="st"> </span>p4+<span class="kw">geom_point</span>(<span class="dt">data=</span>d5, <span class="kw">aes</span>(<span class="dt">x=</span>x5,<span class="dt">y=</span>y5))
 
x6 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">seq</span>(-<span class="dv">3</span>,-<span class="dv">1</span>,<span class="fl">0.001</span>), <span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="fl">0.001</span>))
y6 &lt;-<span class="st"> </span><span class="dv">6</span> *<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">10</span>)/<span class="dv">7</span> +
<span class="st">    </span>(<span class="fl">1.5</span> -<span class="st"> </span><span class="fl">0.5</span> *<span class="st"> </span><span class="kw">abs</span>(x6)) *<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">abs</span>(<span class="kw">abs</span>(x6)-<span class="dv">1</span>)/(<span class="kw">abs</span>(x6)-<span class="dv">1</span>)) -
<span class="st">    </span><span class="dv">6</span> *<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">10</span>) *<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">4</span>-(<span class="kw">abs</span>(x6)-<span class="dv">1</span>)^<span class="dv">2</span>)/<span class="dv">14</span>
d6 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x6=</span>x6,<span class="dt">y6=</span>y6)
p6 &lt;-<span class="st"> </span>p5+<span class="kw">geom_point</span>(<span class="dt">data=</span>d6,<span class="kw">aes</span>(<span class="dt">x=</span>x6,<span class="dt">y=</span>y6), <span class="dt">colour=</span><span class="st">&quot;blue&quot;</span>)

multiplot &lt;-<span class="st"> </span>function (..., <span class="dt">plotlist =</span> <span class="ot">NULL</span>, <span class="dt">cols =</span> <span class="dv">1</span>, <span class="dt">layout =</span> <span class="ot">NULL</span>) {
    plots &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">list</span>(...), plotlist)
    numPlots =<span class="st"> </span><span class="kw">length</span>(plots)
    if (<span class="kw">is.null</span>(layout)) {
        layout &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">seq</span>(<span class="dv">1</span>, cols *<span class="st"> </span><span class="kw">ceiling</span>(numPlots/cols)),
            <span class="dt">ncol =</span> cols, <span class="dt">nrow =</span> <span class="kw">ceiling</span>(numPlots/cols))
    }
    if (numPlots ==<span class="st"> </span><span class="dv">1</span>) {
        <span class="kw">print</span>(plots[[<span class="dv">1</span>]])
    }
    else {
        <span class="kw">grid.newpage</span>()
        <span class="kw">pushViewport</span>(<span class="kw">viewport</span>(<span class="dt">layout =</span> <span class="kw">grid.layout</span>(<span class="kw">nrow</span>(layout),
            <span class="kw">ncol</span>(layout))))
        for (i in <span class="dv">1</span>:numPlots) {
            matchidx &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">which</span>(layout ==<span class="st"> </span>i, <span class="dt">arr.ind =</span> <span class="ot">TRUE</span>))
            <span class="kw">print</span>(plots[[i]], <span class="dt">vp =</span> <span class="kw">viewport</span>(<span class="dt">layout.pos.row =</span> matchidx$row,
                <span class="dt">layout.pos.col =</span> matchidx$col))
        }
    }
}

<span class="kw">multiplot</span>(p1,p2,p3,p4,p5,p6, <span class="dt">cols=</span><span class="dv">2</span>)</code></pre></div>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_point).</code></pre>
<p><img src="_main_files/figure-html/ggplot2_batman-1.png" /><!-- --></p>
</div>
<div id="facet" class="section level2">
<h2><span class="header-section-number">3.9</span> 分面（Facet）</h2>
<p>在《<a href="http://book.douban.com/subject/24527091/">ggplot2: 数据分析与图形艺术</a>》一书的翻译中，一开始译者把facet翻译成切片，我在校稿的时候发现了，给他们写信，推荐翻译成分面，如果是slice这个词，翻译成切片倒是很精准，BSD的硬盘分区就叫slice，但facet从词源上看就是小脸的意思，翻译成分面才到位。给他们写信的时候，我还专门查了<a href="http://dict.cnki.net/">CNKI翻译助手</a>，发现这词在信息学中，翻成分面早已是固定的。我感觉这是我对这本书翻译的最大贡献，校稿过程中发现的少量小问题远比不上这个关键词意思的把握上。</p>
<p>分面可以让我们按照某种给定的条件，对数据进行分组，然后分别画图。 在统计变换一节中，提到如果按切工分组作回归线，显然图会很乱，有了分面功能，我们可以分别作图。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(small, <span class="kw">aes</span>(<span class="dt">x=</span>carat, <span class="dt">y=</span>price))+<span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour=</span>cut))+<span class="kw">scale_y_log10</span>() +<span class="kw">facet_wrap</span>(~cut)+<span class="kw">stat_smooth</span>()</code></pre></div>
<p><img src="_main_files/figure-html/ggplot2_fig18-1.png" /><!-- --></p>
</div>
<div id="theme" class="section level2">
<h2><span class="header-section-number">3.10</span> 主题（Theme）</h2>
<p>通过ggplot画图之后，我们可能还需要对图进行定制，像title, xlab, ylab这些高频需要用到的，自不用说，ggplot2提供了ggtitle(), xlab()和ylab()来实现。 比如：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(small)+<span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>cut, <span class="dt">y=</span>price,<span class="dt">fill=</span>color))
p +<span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Price vs Cut&quot;</span>)+<span class="kw">xlab</span>(<span class="st">&quot;Cut&quot;</span>)+<span class="kw">ylab</span>(<span class="st">&quot;Price&quot;</span>)</code></pre></div>
<p><img src="_main_files/figure-html/ggplot2_fig19-1.png" /><!-- --></p>
<p>但是这个远远满足不了需求，我们需要改变字体，字体大小，坐标轴，背景等各种元素，这需要通过theme()函数来完成。</p>
<p>ggplot2提供一些已经写好的主题，比如theme_grey()为默认主题，我经常用的theme_bw()为白色背景的主题，还有theme_classic()主题，和R的基础画图函数较像。</p>
<p>别外ggthemes包提供了一些主题可供使用，包括：</p>
<pre><code>theme_economist theme_economist_white
theme_wsj       theme_excel
theme_few       theme_foundation
theme_igray     theme_solarized
theme_stata     theme_tufte</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(ggthemes)</code></pre></div>
<pre><code>## Loading required package: ggthemes</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p +<span class="st"> </span><span class="kw">theme_wsj</span>()</code></pre></div>
<p><img src="_main_files/figure-html/ggplot2_fig20-1.png" /><!-- --></p>
<p>在2013年发表的文章<a href="http://pubs.rsc.org/en/content/articlelanding/2013/mt/c3mt00126a#!divAbstract">Putative cobalt- and nickel-binding proteins and motifs in Streptococcus pneumoniae</a>中的图3就是使用theme_stata来画的。</p>
<p>至于如何改变这些元素，我觉得我之前<a href="http://ygc.name/2012/02/17/draw-chinese-character-jiong-ggplot2/">画囧字的博文</a>可以做为例子：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f &lt;-<span class="st"> </span>function(x) <span class="dv">1</span>/(x^<span class="dv">2-1</span>)
x &lt;-<span class="st"> </span><span class="kw">seq</span>(-<span class="dv">3</span>,<span class="dv">3</span>, <span class="dt">by=</span><span class="fl">0.001</span>)
y &lt;-<span class="st"> </span><span class="kw">f</span>(x)
d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span>x,<span class="dt">y=</span>y)
 
p &lt;-<span class="st"> </span><span class="kw">ggplot</span>()
p &lt;-<span class="st"> </span>p+<span class="kw">geom_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>,<span class="dt">color=</span><span class="st">&quot;black&quot;</span>,<span class="dt">size=</span><span class="dv">3</span>,
<span class="kw">aes</span>(<span class="ot">NULL</span>, <span class="ot">NULL</span>,<span class="dt">xmin=</span>-<span class="dv">3</span>, <span class="dt">xmax=</span><span class="dv">3</span>,
<span class="dt">ymin=</span>-<span class="dv">3</span>,<span class="dt">ymax=</span><span class="dv">3</span>, <span class="dt">alpha=</span><span class="fl">0.1</span>))
 
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">data=</span>d, <span class="kw">aes</span>(x,y), <span class="dt">size=</span><span class="dv">3</span>)+<span class="kw">ylim</span>(-<span class="dv">3</span>,<span class="dv">3</span>)

theme_null &lt;-<span class="st"> </span>function() {
    <span class="kw">theme_bw</span>() %+replace%
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.text.x=</span><span class="kw">element_blank</span>(),
    <span class="dt">axis.text.y=</span><span class="kw">element_blank</span>(),
    <span class="dt">legend.position=</span><span class="st">&quot;none&quot;</span>,
    <span class="dt">panel.grid.minor=</span><span class="kw">element_blank</span>(),
    <span class="dt">panel.grid.major=</span><span class="kw">element_blank</span>(),
    <span class="dt">panel.background=</span><span class="kw">element_blank</span>(),
    <span class="dt">axis.ticks=</span><span class="kw">element_blank</span>(),
    <span class="dt">panel.border=</span><span class="kw">element_blank</span>())
}
 
p+<span class="kw">theme_null</span>()+<span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>)+<span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>)</code></pre></div>
<p><img src="_main_files/figure-html/ggplot2_fig21-1.png" /><!-- --></p>
<p>详细的说明，可以参考?theme的帮助文档。</p>
</div>
<div id="section-3.11" class="section level2">
<h2><span class="header-section-number">3.11</span> 二维密度图</h2>
<p>在这个文档里，为了作图方便，我们使用diamonds数据集的一个子集，如果使用全集，数据量太大，画出来散点就糊了，这种情况可以使用二维密度力来呈现。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(carat, price))+<span class="st"> </span><span class="kw">stat_density2d</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> ..level..), <span class="dt">geom=</span><span class="st">&quot;polygon&quot;</span>)+<span class="st"> </span><span class="kw">scale_fill_continuous</span>(<span class="dt">high=</span><span class="st">&#39;darkred&#39;</span>,<span class="dt">low=</span><span class="st">&#39;darkgreen&#39;</span>)</code></pre></div>
<p><img src="_main_files/figure-html/ggplot2_fig22-1.png" /><!-- --></p>
</div>
<div id="ggplot2" class="section level2">
<h2><span class="header-section-number">3.12</span> ggplot2实战</h2>
<p>蝴蝶图，详见《Modern Applied Statistics with S-PLUS》第一章。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">theta &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>*pi, <span class="dt">len=</span><span class="dv">2000</span>)
radius &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">cos</span>(theta)) -<span class="st"> </span><span class="dv">2</span>*<span class="kw">cos</span>(<span class="dv">4</span>*theta) +<span class="st"> </span><span class="kw">sin</span>(theta/<span class="dv">12</span>)^<span class="dv">5</span>
dd &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span>radius*<span class="kw">sin</span>(theta), <span class="dt">y=</span>radius*<span class="kw">cos</span>(theta))
<span class="kw">ggplot</span>(dd, <span class="kw">aes</span>(x, y))+<span class="kw">geom_path</span>()+<span class="kw">theme_null</span>()+<span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>)+<span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>)</code></pre></div>
<p><img src="_main_files/figure-html/ggplot2_fig25-1.png" /><!-- --> 这个图，我想展示的是对细节的修改上，在画囧字的时候，把画布上的元素都给清楚了，我把它定义为theme_null主题，在这里，直接应用，我们可以形成自己的画图风格，并写出自己的主题函数固定下来。</p>
<p>最后以生物界中常用的柱状图+误差图为实例，展示ggplot2非常灵活的图层。以我2011年发表的文章<a href="http://ygc.name/2010/11/23/phosphoproteome-profile-of-human-lung-cancer-cell-line-a549/">Phosphoproteome profile of human lung cancer cell line A549</a>中的westernblot数据为例。这个实例展示了图层，标尺，主题，注释和各种细节微调多种元素。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Normal &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.83</span>, <span class="fl">0.79</span>, <span class="fl">0.99</span>, <span class="fl">0.69</span>)
Cancer &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.56</span>, <span class="fl">0.56</span>, <span class="fl">0.64</span>, <span class="fl">0.52</span>)
m &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">mean</span>(Normal), <span class="kw">mean</span>(Cancer))
s &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">sd</span>(Normal), <span class="kw">sd</span>(Cancer))
d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">V=</span><span class="kw">c</span>(<span class="st">&quot;Normal&quot;</span>, <span class="st">&quot;Cancer&quot;</span>), <span class="dt">mean=</span>m, <span class="dt">sd=</span>s)
d$V &lt;-<span class="st"> </span><span class="kw">factor</span>(d$V, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;Normal&quot;</span>, <span class="st">&quot;Cancer&quot;</span>))

p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(d, <span class="kw">aes</span>(V, mean, <span class="dt">fill=</span>V, <span class="dt">width=</span>.<span class="dv">5</span>))
p &lt;-<span class="st"> </span>p+<span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>mean, <span class="dt">ymax=</span>mean+sd, <span class="dt">width=</span>.<span class="dv">2</span>), 
                     <span class="dt">position=</span><span class="kw">position_dodge</span>(<span class="dt">width=</span>.<span class="dv">8</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">position=</span><span class="kw">position_dodge</span>(<span class="dt">width=</span>.<span class="dv">8</span>), <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">scale_fill_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;grey80&quot;</span>, <span class="st">&quot;white&quot;</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme_bw</span>() +<span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;none&quot;</span>) +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>)
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">face=</span><span class="st">&quot;bold&quot;</span>, <span class="dt">size=</span><span class="dv">12</span>), 
               <span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">face=</span><span class="st">&quot;bold&quot;</span>, <span class="dt">size=</span><span class="dv">12</span>))
p &lt;-<span class="st"> </span>p+<span class="kw">scale_y_continuous</span>(<span class="dt">expand=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">1.2</span>), <span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">1.2</span>, <span class="dt">by=</span>.<span class="dv">2</span>))
p &lt;-<span class="st"> </span>p+<span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="dv">1</span>, <span class="dt">y=</span>.<span class="dv">98</span>, <span class="dt">xend=</span><span class="dv">1</span>, <span class="dt">yend=</span><span class="fl">1.1</span>))
p &lt;-<span class="st"> </span>p+<span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="dv">2</span>, <span class="dt">y=</span>.<span class="dv">65</span>, <span class="dt">xend=</span><span class="dv">2</span>, <span class="dt">yend=</span><span class="fl">1.1</span>))
p &lt;-<span class="st"> </span>p+<span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="dv">1</span>, <span class="dt">y=</span><span class="fl">1.1</span>, <span class="dt">xend=</span><span class="dv">2</span>, <span class="dt">yend=</span><span class="fl">1.1</span>))
p &lt;-<span class="st"> </span>p +<span class="st"> </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x=</span><span class="fl">1.5</span>, <span class="dt">y=</span><span class="fl">1.08</span>, <span class="dt">label=</span><span class="st">&quot;*&quot;</span>)
<span class="kw">print</span>(p)</code></pre></div>
<p><img src="_main_files/figure-html/ggplot2_26-1.png" /><!-- --></p>
<p>更多实例，可以参考我使用<a href="http://ygc.name/2011/08/17/ggplot2-version-figures-25-recipes-started-r/">ggplot2实现&lt;25 Recipes for Getting Started with R&gt;一书中的所有图片</a>.</p>
<pre><code>2013-05-18</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="section-4.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
